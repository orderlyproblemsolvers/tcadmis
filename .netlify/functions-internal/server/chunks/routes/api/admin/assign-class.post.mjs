import{d as e,r as s,a,c as t}from"../../../_/nitro.mjs";import"@tidbcloud/serverless";import"node:crypto";import"node:http";import"node:https";import"node:events";import"node:buffer";import"@iconify/utils";import"consola";import"node:fs";import"node:path";const o=e(async e=>{var o;const r=await s(e),c=a();try{if("remove"===r.action)return await c.execute("UPDATE classes SET teacher_id = NULL WHERE name = ?",[r.className]),{success:!0,message:"Teacher removed successfully"};const e=parseInt(r.teacherId),s="SELECT COUNT(*) as count FROM classes WHERE teacher_id = ? AND name != ?",[a]=await c.execute(s,[e,r.className]);if((a.count||(Array.isArray(a)?null==(o=a[0])?void 0:o.count:0)||0)>=2)throw t({statusCode:400,message:"This teacher is already assigned to 2 classes (Maximum Limit)."});return await c.execute("UPDATE classes SET teacher_id = ? WHERE name = ?",[e,r.className]),{success:!0,message:"Teacher assigned successfully"}}catch(e){throw t({statusCode:e.statusCode||500,message:e.message})}});export{o as default};
//# sourceMappingURL=assign-class.post.mjs.map
