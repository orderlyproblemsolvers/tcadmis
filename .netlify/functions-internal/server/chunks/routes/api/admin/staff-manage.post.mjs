import{d as e,r as a,a as t,e as r,c as o}from"../../../_/nitro.mjs";import"@tidbcloud/serverless";import"node:crypto";import"node:http";import"node:https";import"node:events";import"node:buffer";import"@iconify/utils";import"consola";import"node:fs";import"node:path";const s=e(async e=>{const s=await a(e),n=t();if("admin"!==(await r(e)).user.role)throw o({statusCode:403,message:"Unauthorized"});try{if("delete"===s.action){if(!s.id)throw o({statusCode:400,message:"ID required"});return await n.execute("UPDATE classes SET teacher_id = NULL WHERE teacher_id = ?",[s.id]),await n.execute("DELETE FROM users WHERE id = ?",[s.id]),{success:!0,message:"Staff deleted successfully"}}if("update"===s.action){if(!s.id)throw o({statusCode:400,message:"ID required"});await n.execute("UPDATE users SET full_name = ?, email = ? WHERE id = ?",[s.full_name,s.email,s.id]);const e="\n        INSERT INTO profiles_teacher (\n          user_id, photo_url, qualification, phone, address,\n          guarantor_name, guarantor_phone, guarantor_rel\n        ) VALUES (?, ?, ?, ?, ?, ?, ?, ?)\n        ON DUPLICATE KEY UPDATE\n          photo_url = VALUES(photo_url),\n          qualification = VALUES(qualification),\n          phone = VALUES(phone),\n          address = VALUES(address),\n          guarantor_name = VALUES(guarantor_name),\n          guarantor_phone = VALUES(guarantor_phone),\n          guarantor_rel = VALUES(guarantor_rel)\n      ";return await n.execute(e,[s.id,s.photo_url||null,s.qualification||null,s.phone||null,s.address||null,s.guarantor_name||null,s.guarantor_phone||null,s.guarantor_rel||null]),{success:!0,message:"Staff profile updated successfully"}}throw o({statusCode:400,message:"Invalid action"})}catch(e){throw console.error("Staff Manage Error:",e),o({statusCode:500,message:e.message||"Database error"})}});export{s as default};
//# sourceMappingURL=staff-manage.post.mjs.map
