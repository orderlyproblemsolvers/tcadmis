import{d as e,b as t,a as s,c as r}from"../../../_/nitro.mjs";import"@tidbcloud/serverless";import"node:crypto";import"node:http";import"node:https";import"node:events";import"node:buffer";import"@iconify/utils";import"consola";import"node:fs";import"node:path";const o=e(async e=>{const{id:o}=t(e),n=s();if(console.log(`[API] Fetching details for Student ID: ${o}`),!o)throw r({statusCode:400,message:"Student ID is required"});try{let e=null;try{const t=await n.execute("SELECT * FROM students WHERE id = ?",[o]),s=Array.isArray(t)?t:t.rows||[];s.length>0&&(e=s[0])}catch(e){throw console.error("[API] Student Fetch Error:",e.message),r({statusCode:500,message:`DB Error: ${e.message}`})}if(!e)throw r({statusCode:404,message:"Student not found"});let t=[];try{const e="\n        SELECT \n          session, \n          term, \n          class_level,\n          MAX(created_at) as date_generated\n        FROM academic_records \n        WHERE student_id = ? \n        GROUP BY session, term, class_level\n        ORDER BY session DESC, term DESC\n      ",s=await n.execute(e,[o]);t=Array.isArray(s)?s:s.rows||[]}catch(e){console.warn("[API] Warning: Could not fetch history (Table might be missing or empty):",e.message)}return{student:e,history:t}}catch(e){throw console.error("[API] Critical Error:",e),r({statusCode:e.statusCode||500,message:e.message||"Internal Server Error"})}});export{o as default};
//# sourceMappingURL=student-details.get.mjs.map
