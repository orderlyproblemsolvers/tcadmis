import{d as s,e,c as t,r as a,a as o}from"../../../_/nitro.mjs";import"@tidbcloud/serverless";import"node:crypto";import"node:http";import"node:https";import"node:events";import"node:buffer";import"@iconify/utils";import"consola";import"node:fs";import"node:path";const i=s(async s=>{if("admin"!==(await e(s)).user.role)throw t({statusCode:403,message:"Unauthorized"});const i=await a(s);if(!(i.first_name&&i.last_name&&i.admission_number&&i.class_level))throw t({statusCode:400,message:"All fields are required"});const r=o();try{return await r.execute("INSERT INTO students (first_name, last_name, admission_number, class_level) \n       VALUES (?, ?, ?, ?)",[i.first_name,i.last_name,i.admission_number,i.class_level]),{success:!0}}catch(s){if(s.message&&s.message.includes("Duplicate entry"))throw t({statusCode:409,message:"Admission Number already exists"});if(s.message&&s.message.includes("foreign key constraint fails"))throw t({statusCode:400,message:"Invalid Class Level selected"});throw t({statusCode:500,message:s.message})}});export{i as default};
//# sourceMappingURL=students.post.mjs.map
