import{d as e,r as t,a as s,c as n}from"../../../_/nitro.mjs";import"@tidbcloud/serverless";import"node:crypto";import"node:http";import"node:https";import"node:events";import"node:buffer";import"@iconify/utils";import"consola";import"node:fs";import"node:path";const a=e(async e=>{const a=await t(e),r=s();console.log(`[API] Processing Action: ${a.action}`);try{if("delete"===a.action){if(!a.id)throw n({statusCode:400,message:"ID required"});return await r.execute("DELETE FROM academic_records WHERE student_id = ?",[a.id]),await r.execute("DELETE FROM term_reports WHERE student_id = ?",[a.id]),await r.execute("DELETE FROM students WHERE id = ?",[a.id]),{success:!0}}if("move"===a.action)return await r.execute("UPDATE students SET class_level = ? WHERE id = ?",[a.new_class,a.id]),{success:!0};if("create"===a.action){if(!a.first_name||!a.last_name||!a.class_level)throw n({statusCode:400,message:"Name and Class are required"});const e=[a.first_name,a.last_name,a.admission_number,a.class_level,a.gender,a.dob||null,a.photo_url||null,a.allergies||null,a.special_needs?1:0,a.parent1_name||null,a.parent1_phone||null,a.parent1_rel||null,a.parent2_name||null,a.parent2_phone||null,a.parent2_rel||null],t="\n        INSERT INTO students (\n          first_name, last_name, admission_number, class_level, gender, \n          dob, photo_url, allergies, special_needs,\n          parent1_name, parent1_phone, parent1_rel,\n          parent2_name, parent2_phone, parent2_rel\n        ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)\n      ";return await r.execute(t,e),console.log(`[API] Success: Created student ${a.first_name}`),{success:!0,message:"Student profile created successfully"}}}catch(e){throw console.error("‚ùå [API ERROR] Student Manage Failed:",e),n({statusCode:500,message:e.message||"Database operation failed. Check server logs."})}});export{a as default};
//# sourceMappingURL=student-manage.post.mjs.map
