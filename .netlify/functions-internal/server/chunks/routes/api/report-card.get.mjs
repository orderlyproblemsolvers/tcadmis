import{d as e,b as s,a as t,c as o}from"../../_/nitro.mjs";import"@tidbcloud/serverless";import"node:crypto";import"node:http";import"node:https";import"node:events";import"node:buffer";import"@iconify/utils";import"consola";import"node:fs";import"node:path";const a=e(async e=>{const{student_id:a,session:n,term:r}=s(e),c=t();try{const getRows=e=>Array.isArray(e)?e:e.rows||[],e=await c.execute("SELECT * FROM students WHERE id = ?",[a]),s=getRows(e)[0];if(!s)throw o({statusCode:404,message:"Student not found"});const t="\n      SELECT subject, \n             ca1_score as ca1, \n             ca2_score as ca2, \n             assignment_score as assignment, \n             class_exercise_score as class_ex, \n             affective_score as affective, \n             psychomotor_score as psychomotor, \n             exam_score as exam,\n             (ca1_score + ca2_score + assignment_score + class_exercise_score + affective_score + psychomotor_score + exam_score) as total\n      FROM academic_records \n      WHERE student_id = ? AND session = ? AND term = ?\n    ",i=getRows(await c.execute(t,[a,n,r])),m="\n      SELECT class_teacher_comment, head_teacher_comment, \n             total_paces, pace_average, days_absent, next_term_begins, reading_comprehension\n      FROM term_reports \n      WHERE student_id = ? AND session = ? AND term = ?\n    ",_=getRows(await c.execute(m,[a,n,r]))[0];return{student:s,academics:i,meta:{session:n,term:r,days_absent:(null==_?void 0:_.days_absent)||0,next_term_begins:(null==_?void 0:_.next_term_begins)||null,total_paces:(null==_?void 0:_.total_paces)||"N/A",pace_average:(null==_?void 0:_.pace_average)||"N/A",reading_comprehension:(null==_?void 0:_.reading_comprehension)||"N/A"},comments:{teacher:(null==_?void 0:_.class_teacher_comment)||"",principal:(null==_?void 0:_.head_teacher_comment)||""}}}catch(e){throw console.error("Report API Error:",e),o({statusCode:500,message:e.message||"Failed to generate report card"})}});export{a as default};
//# sourceMappingURL=report-card.get.mjs.map
