import{d as s,b as e,e as t,a as r,c as o}from"../../../_/nitro.mjs";import"@tidbcloud/serverless";import"node:crypto";import"node:http";import"node:https";import"node:events";import"node:buffer";import"@iconify/utils";import"consola";import"node:fs";import"node:path";const a=s(async s=>{const{class_name:a}=e(s),n=await t(s),i=r();console.log(`[API] Fetching roster for class: ${a} | Teacher: ${n.user.id}`);try{const s="SELECT name FROM classes WHERE name = ? AND teacher_id = ?",e=await i.execute(s,[a,n.user.id]);if(0===(Array.isArray(e)?e:e.rows||[]).length)throw o({statusCode:403,message:"Unauthorized: You are not assigned to this class."});const t="\n      SELECT id, first_name, last_name, admission_number, gender \n      FROM students \n      WHERE class_level = ? \n      ORDER BY last_name ASC\n    ",r=await i.execute(t,[a]);return{class_name:a,students:Array.isArray(r)?r:r.rows||[]}}catch(s){throw console.error("Class Roster Error:",s),o({statusCode:500,message:s.message})}});export{a as default};
//# sourceMappingURL=class-roster.get.mjs.map
