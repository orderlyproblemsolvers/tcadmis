import{d as s,b as t,e,a as o,c as r}from"../../../_/nitro.mjs";import"@tidbcloud/serverless";import"node:crypto";import"node:http";import"node:https";import"node:events";import"node:buffer";import"@iconify/utils";import"consola";import"node:fs";import"node:path";const a=s(async s=>{const{id:a}=t(s),n=await e(s),i=o();if(!a)throw r({statusCode:400,message:"Student ID required"});try{const s="SELECT * FROM students WHERE id = ?",t=await i.execute(s,[a]),e=Array.isArray(t)?t:t.rows||[];if(0===e.length)throw r({statusCode:404,message:"Student not found"});const o=e[0],d="SELECT name FROM classes WHERE name = ? AND teacher_id = ?",c=await i.execute(d,[o.class_level,n.user.id]);if(0===(Array.isArray(c)?c:c.rows||[]).length)throw r({statusCode:403,message:"Unauthorized: This student is not in your assigned class."});let m=[];try{const s="\n          SELECT session, term, class_level\n          FROM academic_records \n          WHERE student_id = ? \n          GROUP BY session, term, class_level\n          ORDER BY session DESC, term DESC\n        ",t=await i.execute(s,[a]);m=Array.isArray(t)?t:t.rows||[]}catch(s){}return{student:o,history:m}}catch(s){throw r({statusCode:s.statusCode||500,message:s.message})}});export{a as default};
//# sourceMappingURL=student-details.get.mjs.map
