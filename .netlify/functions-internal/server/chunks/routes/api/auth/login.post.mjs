import{d as o,r,c as s,a as e,s as t}from"../../../_/nitro.mjs";import a from"bcrypt";import"@tidbcloud/serverless";import"node:crypto";import"node:http";import"node:https";import"node:events";import"node:buffer";import"@iconify/utils";import"consola";import"node:fs";import"node:path";const i=o(async o=>{const i=await r(o);if(!i.email||!i.password)throw s({statusCode:400,message:"Email and password required"});const m=e();try{const r=await m.execute("SELECT * FROM users WHERE email = ?",[i.email.trim()]),e=null==r?void 0:r[0];if(!e)throw s({statusCode:401,message:"Invalid email or password"});if(!await a.compare(i.password.trim(),e.password_hash))throw s({statusCode:401,message:"Invalid email or password"});return await t(o,{user:{id:e.id,email:e.email,full_name:e.full_name,role:e.role}}),{success:!0,role:e.role}}catch(o){if(console.error("Login Error:",o),o.statusCode)throw o;throw s({statusCode:500,message:"Server error"})}});export{i as default};
//# sourceMappingURL=login.post.mjs.map
